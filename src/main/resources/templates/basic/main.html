<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <link th:href="@{/css/bootstrap.min.css}"
          href="../css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container" style="max-width: 600px">
    <div class="py-5 text-center">
        <h2>ê²Œì‹œê¸€ ëª©ë¡</h2>
        <br>
        <h2 th:if="${param.status}" th:text="ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."></h2>
        <h4 class="mb-3" th:text="|${member.name}ë‹˜ ì•ˆë…•í•˜ì„¸ìš”!ğŸ–¥|"></h4>
    </div>

    <div class="row">
        <div class="col">
            <button class="btn btn-primary float-end"
                    th:onclick="|location.href='@{/writing}'|"
                    onclick="location.href='addForm.html'"
                    type="button">ê¸€ì“°ê¸°</button>
        </div>
        <div class="col">
            <button class="btn btn-primary float-end"
                    th:onclick="|location.href='@{/userinfo}'|"
                    onclick="location.href='main.html'"
                    type="button">íšŒì›ìƒì„¸ì •ë³´</button>
        </div>
        <div class="col">
            <button class="btn btn-primary float-end"
                    th:onclick="|location.href='@{/userinfo/edit}'|"
                    onclick="location.href='main.html'"
                    type="button">íšŒì›ì •ë³´ìˆ˜ì •</button>
        </div>
        <div class="col">
            <button class="btn btn-primary float-end"
                    th:onclick="|location.href='@{/logout}'|"
                    onclick="location.href='main.html'"
                    type="button">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
    </div>
    <div id="map" style="width:100%;height:350px;"></div>

    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e890d377680f8bd3ffa9d0a49a4a05b0&libraries=services"></script>
    <script>
        // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì„ í‘œì¶œí•  ì¸í¬ìœˆë„ìš° ì…ë‹ˆë‹¤
        var infowindow = new kakao.maps.InfoWindow({zIndex:1});

        var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div
            mapOption = {
                center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
            };

        // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
        var map = new kakao.maps.Map(mapContainer, mapOption);

        // ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
        var ps = new kakao.maps.services.Places();

        // í‚¤ì›Œë“œë¡œ ì¥ì†Œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤
        ps.keywordSearch('ì‚°ë³¸ë™', placesSearchCB);

        // í‚¤ì›Œë“œ ê²€ìƒ‰ ì™„ë£Œ ì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜ ì…ë‹ˆë‹¤
        function placesSearchCB (data, status, pagination) {
            if (status === kakao.maps.services.Status.OK) {

                // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•˜ê¸°ìœ„í•´
                // LatLngBounds ê°ì²´ì— ì¢Œí‘œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
                var bounds = new kakao.maps.LatLngBounds();

                for (var i=0; i<data.length; i++) {
                    displayMarker(data[i]);
                    bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
                }

                // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤
                map.setBounds(bounds);
            }
        }

        // ì§€ë„ì— ë§ˆì»¤ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
        function displayMarker(place) {

            // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤
            var marker = new kakao.maps.Marker({
                map: map,
                position: new kakao.maps.LatLng(place.y, place.x)
            });

            // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
            kakao.maps.event.addListener(marker, 'click', function() {
                // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì´ ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë©ë‹ˆë‹¤
                infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
                infowindow.open(map, marker);
            });
        }
    </script>
    <hr class="my-4">
    <div>
        <table class="table">
            <thead>
            <tr>
                <th>ID</th>
                <th>ê¸€ì œëª©</th>
                <th>ì‘ì„±ì¼</th>
                <th>ì‘ì„±ì</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="writing:${writings}">
                <td><a href="writing.html" th:href="@{/{writingId}(writingId=${writing.id})}" th:text="${writing.id}"></a></td>
                <td><a href="writing.html" th:href="@{|/${writing.id}|}" th:text="${writing.title}">ê¸€ì œëª©</a></td>
                <td><a href="writing.html" th:href="@{|/${writing.id}|}" th:text="${writing.date}">ë‚ ì§œ</a></td>
                <td><a href="writing.html" th:href="@{|/${writing.id}|}" th:text="${writing.member.loginId}">ì‘ì„±ì</a></td>
            </tr>
            </tbody>
        </table>
    </div>
</div> <!-- /container -->

</body>
</html>